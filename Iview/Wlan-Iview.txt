Wlan:
=====
- Scanning procedure in depth in ATH9k
- what is slave dfs and master dfs & How radar will detected in wlan devices
- Significance of regulatory domain in Wlan
- Channel switch announcement
- Difference in IEEE80211 standards a, b, g, n, ac, ax, ah
- 4 way handshake
- What is short gaurd interval
- CSMA/CA and CSMA/CD
- What is dcf, pcf concept
- What is difs, sifs and aifs
- How QoS packets are queu and transmitted
- What is BlockAck
- Difference between AMSDU and AMPDU
 

Answers:
========
Scanning procedure in Wlan:
===========================
Several parameters are used in the scanning procedure. These parameters may be
specified by the user; many implementations have default values for these
parameters in the driver.

- BSSType
- BSSID
- SSID
- ScanType
- ChannelList
- ProbeDelay
- MinChannelTime and MaxChannelTime


BSSType (independent, infrastructure, or both)
----------------------------------------------
Scanning can specify whether to seek out independent ad hoc networks,
infrastructure networks, or all networks.

BSSID (individual or broadcast)
-------------------------------
The device can scan for a specific network to join (individual) or for any
network that is willing to allow it to join (broadcast). When 802.11 devices
are moving, setting the BSSID to broadcast is a good idea because the scan
results will include all BSSs in the area.

SSID ("network name")
---------------------
The SSID assigns a string of bits to an extended service set. Most products
refer to the SSID as the network name because the string of bits is commonly
set to a human-readable string. Clients wishing to find any network should
set this to the broadcast SSID.

ScanType (active or passive)
----------------------------
Active scanning uses the transmission of Probe Request frames to identify
networks in the area. Passive scanning saves battery power by listening for
Beacon frames.

ChannelList
-----------
Scans must either transmit a Probe Request or listen on a channel for the
existence of a network. 802.11 allows stations to specify a list of channels
to try. Products allow configuration of the channel list in different ways.
What exactly constitutes a channel depends on the physical layer in use.
With direct-sequence products, it is a list of channels. 
With frequency-hopping products, it is a hop pattern.

ProbeDelay
----------
This is the delay, in microseconds, before the procedure to probe a channel
in active scanning begins. This delay ensures that an empty or lightly loaded
channel does not completely block the scan.

MinChannelTime and MaxChannelTime
---------------------------------
These values, specified in time units (TUs), specify the minimum and 
maximum amount of time that the scan works with any particular channel.

There are two types of scanning: Passive scan and Active scan

Passive Scan:
-------------
Passive scanning saves battery power because it does not require transmitting.
In passive scanning, a station moves to each channel on the channel list 
and waits for Beacon frames. Any Beacons received are buffered to extract
information about the BSS that sent them.
In the passive scanning procedure, the station sweeps from channel to channel
and records information from any Beacons it receives. Beacons are designed to
allow a station to find out everything it needs to match parameters with the
basic service set (BSS) and begin communications.

Active Scan:
------------
In active scanning, a station takes a more assertive role. On each channel,
Probe Request frames are used to solicit responses from a network with a
given name. Rather than listening for that network to announce itself, 
an active scan attempts to find the network. Stations using active scanning
employ the following procedure for each channel in the channel list:
- Move to the channel and wait for either an indication of an incoming frame
  or for the ProbeDelay timer to expire. If an incoming frame is detected,
  the channel is in use and can be probed. The timer prevents an empty channel
  from blocking the entire procedure; the station won't wait indefinitely for
  incoming frames.
- Gain access to the medium using the basic DCF access procedure and send 
  a Probe Request frame.
- Wait for the minimum channel time, MinChannelTime, to elapse.
  - If the medium was never busy, there is no network. Move to the next
    channel.
  - If the medium was busy during the MinChannelTime interval, wait until
    the maximum time, MaxChannelTime, and process any Probe Response frames.
Probe Response frames are generated by networks when they hear a Probe Request
that is searching for the extended service set to which the network belongs.
Probe Request frames can also use a broadcast SSID, which triggers a 
Probe Response from all 802.11 networks in the area.
One station in each BSS is responsible for responding to Probe Requests.
The station that transmitted the last Beacon frame is also responsible for
transmitting any necessary Probe Response frames. In infrastructure networks,
the access points transmit Beacons and thus are also responsible for
responding to itinerant stations searching the area with Probe Requests.
IBSSs may pass around the responsibility of sending Beacon frames, so the
station that transmits Probe Response frames may vary. Probe Responses are
unicast management frames and are therefore subject to the positive
acknowledgment requirement of the MAC.
It is common for multiple Probe Responses to be transmitted as a result of 
a single Probe Request. The purpose of the scanning procedure is to find
every basic service area that the scanning station can join, so a broadcast
Probe Request results in a response from every access point within range. 
Any overlapping independent BSSs may also respond.

The relationship between the transmission of Probe frames and the various
timing intervals that can be configured as part of a scan.
- The scanning station transmits the Probe Request after gaining access to
  the medium. Both access points respond with a Probe Response that reports
  their network's parameters. Note that the second Probe Response is subject
  to the rules of the distributed coordination function and must wait for 
  the contention window to elapse before transmitting.
- The first response is transmitted before the minimum response time elapses,
  so the station waits until the maximum response time has elapsed before
  collating the results. In areas with a large number of networks, it may 
  be necessary to adjust the maximum channel time so the responses from all 
  the access points in the area can be processed.
  
Scan Report:
------------
A scan report is generated at the conclusion of a scan. The report lists all
the BSSs that the scan discovered and their parameters. The complete parameter
list enables the scanning station to join any of the networks that it
discovered. In addition to the BSSID, SSID, and BSSType, the
parameters also include:[*]
[*] The items actually exposed by any particular software vary.

Beacon interval (integer): Each BSS can transmit Beacon frames at its own
                           specific interval, measured in TUs.

DTIM period (integer): DTIM frames are used as part of the powersaving
                       mechanism.

Timing parameters: Two fields assist in synchronizing the station's timer to
                   the timer used by a BSS. The Timestamp field indicates the
                   value of the timer received by the scanning station; the
                   other field is an offset to enable a station to match timing
                   information to join a particular BSS.

PHY parameters, CF parameters, and IBSS parameters: These three facets of the
network have their own parameter sets. Channel information is included in the
physical-layer parameters.

BSSBasicRateSet: The basic rate set is the list of data rates that must be
                 supported by any station wishing to join the network.
                 Stations must be able to receive data at all the rates listed
                 in the set. The basic rate set is composed of the mandatory
                 rates in the Supported Rates information element of management
                 frames.

FAQ's [Scanning procedure]:
---------------------------
a.   Difference between Direct prob and Null/Broadcast prob request ?
Ans: Direct prob request: A client station that is looking for a specific 
                          SSID sends a probe request with the SSID field set
                          to the specific SSID. If a directed probe request
                          is sent, all APs that support that specific SSID
                          and hear the request should reply by sending a
                          probe response.
     Null/Broadcast prob request: A client station that is looking for any 
                          SSID sends a probe request with the SSID field set
                          to null. If a null probe request is sent, all APs
                          that hear the request should reply by sending a
                          probe response.
                   
b.   Difference between Beacon frame and Probe response frame ?
Ans: The information that is contained inside the body of a probe response
     frame is the same information that can be found in a beacon frame, with
     the exception of the traffic indication map (TIM).

c.   Why we need two types of scanning (Active/Passive) ?
Ans: Passive scan can not find the networks which is configured and enabled
     as hidden ssid but it can scan DFS channel. Active scanning can find
     the hidden network by direct probe request/response.

2.   What is dfs, how it works? What is slave dfs and master dfs ?
Ans: Wi-Fi networks operate in areas of RF spectrum that require no licence
     to operate. One particular service that shares spectrum with wireless
     LANs is radar. Some types of radar installation operate in the 5GHz band
     that is used by Wi-Fi network. This means that they may use some of the
     same frequencies that are used for Wi-Fi networks. This doesn’t apply to
     all radar stations that have been deployed; there are many radar
     installations do not use 5GHz.
     However, due to the coexistence of both radar and Wi-Fi networks in the 
     same area of spectrum, the Wi-Fi standard (IEEE 802.11, and dfs added
     as WiFi regulatory specification amendmen 80211h) was designed to
     incorporate a spectrum sharing mechanism on 5GHz to ensure that Wi-Fi
     networks do not operate on frequencies (hence causing interference)
     that are used by nearby radar stations. This mechanism is known as
     Dynamic Frequency Selection (DFS) and is designed to mitigate 
     interference to 5GHz radar by WLANs.

     How Does DFS Work?
     The main purpose of DFS is to avoid WLAN systems interference with Radar
     systems. If WLAN AP detects a Radar on current operating channel it 
     should move to another non Radar detected channel by following set of
     DFS rules and the STA associated to that AP must move to the channel
     designated by AP.
     
     DFS parameters:
        Parameters                              value
        --------------------------------------------------
        Channel Availability check              60sec
        Channel move time                       10sec
        Channel Closing Transmission Time       1sec        
        Non-Occupancy Period                    30minutes
        In-Service Monitoring
     
     Channel Availability check: Before an AP will use a channel that may be
     impacted by radar, it will perform a “Channel Availability Check” to
     check for radar signals on that channel. The AP will listen for 
     60 seconds for the presence of radar signals. If no radar is detected,
     then the channel is designated as being an “Available Channel”.
     
     In-Service Monitoring: Once an AP is operating on a DFS channel, it has
     to monitor for the presence of radar signals appearing on that channel.
     This is known as “In-Service Monitoring”.
     The AP must continuously monitor its channel for the presence of radar
     signals. If a radar signal is detected, then the AP must cease 
     transmissions on the channel within the “Channel Move Time”, which is 
     10 seconds in the EU/UK.
     At the end of this period, the AP will have ceased transmissions and
     moved to a new channel.
     Prior to moving channels, some WLAN solutions may provide a 
     “Channel Switch Announcement” 802.11 frame to connected clients to
     advise them which channel the AP will be moving to. Support for this on
     both WLAN infrastructure and client equipment seems to be optional from
     my own observations and should not be relied upon as a reliable method
     for clients to find the AP on its new channel.
     Experience shows that there are variations between WLAN solutions around
     which channels an AP will choose to move to when radar is detected. In
     some solutions, APs that detect radar will move to channel 36 exclusively.
     In other solutions, APs will choose to move to any of the available
     non-DFS channels. Some will jump to any available 5GHz channel they
     find (DFS or non-DFS). Behaviour in this area seems to be inconsistent
     and is not defined within the 802.11 standard.
     
     Non-Occupancy Period: Once radar has been detected on a channel, then
     the “Non-Occupancy Period” begins. This is a 30-minute period in which
     no further transmissions will be made by the AP on the affected channel.
     At the end of the 30-minute period, most APs will attempt to return to
     their original channel, subject to a channel availability check.
     (Again behaviour in this area varies between vendors)
    
    Are All 5GHz Channels Subject to DFS?
    No, not all channels in the 5GHz band are subject to DFS. The channels
    that are exempt vary from country to country, as dictated by local
    regulations.
    DFS is applicable on 5GHz channels. The 5GHz band is divided into several
    sections referred to Unlicensed information infrastructure (UNII).
    UNII-1 band is designated for indoor operations.
    UNII-2 and UNII-2e (extended band) for indoor and outdoor operations.
    UNII-3 is intended mainly for Radar products and may be used as indoor
    for long distance RF links WLAN as well.
       
    Band	      DFS	          Channel	  Frequency (MHz)
    ------------------------------------------------------
    U-NII-1		                  36 – 48	  5170 – 5250
    U-NII-2A	  DFS required	  52 – 64	  5250 – 5330
    U-NII-2C	  DFS required    100 – 140	  5490 – 5710
    U-NII-3		                  149 – 165	  5735 – 5835


3.  Channel switch announcement: 
    ---------------------------- 
    Once AP detects radar on operating channel, CSA element ID will be
    included in beacons and probe response to instruct the STA to move to
    new channel. CSA Element ID is shown in below figure.
     __________________________________________________________________
    |         |        |                |             |                |
    | Element | Length | Channel switch | New channel | Channel switch |
    |   ID    |        |      mode      |    Number   |      count     |
    |_________|________|________________|_____________|________________|
        1        1             1             1               1
    
    The slave device should respond to C.S.A element by checking its parameters.
     - If Channel switch mode is SET slave device shall stop transmit to AP
     - If Channel switch mode is CLEAR slave doesn't have any dependency on AP
      for its operation.
      
    Length : set to 3 bytes
    Channel Switch Mode : Indicates any restrictions on transmission until a
    channel switch. An AP in a BSS or a STA in an IBSS sets the Channel Switch
    Mode field to either 0 or 1 on transmission. In an MBSS,the Channel Switch
    Mode Field is reserved
    New Channel Number: set to the number of the channel to which the STA
    is moving.
    Channel Switch Count: for nonmesh STAs, this  field either is set to the
    number of TBTTs until the STA sending the Channel Switch Announcement
    element switches to the new channel or is set to 0. A value of 1 indicates
    that the switch occurs immediately before the next TBTT. A value of 0
    indicates that the switch occurs at any time after the frame containing
    the element is transmitted.
